<span *ngIf="error">
  <app-error-page></app-error-page>
</span>

<div id="evaluation-content" *ngIf="!evaluateLoading && !error" fxLayout="row" [@.disabled]="true">
  <span fxFlex="10"></span>

  <div fxFlex="80">
    <hr class="combo_breaker">
    <section fxLayoutAlign="start center">
      <div fxFlex>
        <h1 id="summary">
          {{ "EVALUATION_PAGE.summary.title" | translate }}
        </h1>

        <div class="summary_info" fxLayout="column" fxLayoutAlign="space-around center">
        <span fittext [maxFontSize]="22" class="url">
          <a class="hidden_link" href="{{ json.system.url.inputUrl }}"
             target="_blank">{{ json.system.url.inputUrl }}</a>
        </span>
          <span fittext [maxFontSize]="25">
          {{json.metadata.passed + json.metadata.failed + json.metadata.inapplicable + json.metadata.warning}} {{"EVALUATION_PAGE.summary.rules" | translate}}
        </span>
        </div>

        <div class="summary_icons" fxLayout="row" fxLayoutGap="3%" fxLayoutAlign="center">
          <div>
            <span class="screenreader">{{"EVALUATION_PAGE.summary.passed" | translate}}</span>
            <mat-icon class="passed">check_circle_outline</mat-icon>
            {{ json.metadata.passed }}
          </div>
          <div>
            <span class="screenreader">{{"EVALUATION_PAGE.summary.failed" | translate}}</span>
            <mat-icon class="failed">highlight_off</mat-icon>
            {{ json.metadata.failed }}
          </div>
          <div>
            <span class="screenreader">{{"EVALUATION_PAGE.summary.warning" | translate}}</span>
            <mat-icon class="warning">warning</mat-icon>
            {{ json.metadata.warning }}
          </div>
          <div>
            <span class="screenreader">{{"EVALUATION_PAGE.summary.inapplicable" | translate}}</span>
            <mat-icon class="inapplicable">not_interested</mat-icon>
            {{ json.metadata.inapplicable }}
          </div>
        </div>
      </div>
    </section>

    <hr class="combo_breaker">

    <section class="filters">
      <div fxLayout="column">
        <h1 id="filters">
          {{ "EVALUATION_PAGE.filters.title" | translate }}
        </h1>

        <div fxLayout="row" fxShow.gt-xs="false" fxShow="true">
          <button class="buttons" mat-stroked-button fxFill (click)="showFilters = !showFilters">
            {{ "EVALUATION_PAGE.filters.toggle" | translate }}
          </button>
        </div>

        <div fxLayout="row" *ngIf="showFilters">
          <div fxLayout.gt-xs="row" fxLayout="column" fxLayoutAlign.gt-xs="center stretch" fxFlex>
            <div class="filter left border" fxFlex.gt-xs="25"
                 [ngClass.lt-sm]="{'right':true, 'bottom-border':true, 'border':false}">
              <h2>
                {{"EVALUATION_PAGE.filters.outcome" | translate}}
              </h2>
              <mat-checkbox class="passed__checkbox" [(ngModel)]="showPassed"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_passed_rule" | translate }}
              </mat-checkbox>
              <br>
              <mat-checkbox class="failed__checkbox" [(ngModel)]="showFailed"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_failed_rule" | translate }}
              </mat-checkbox>
              <br>
              <mat-checkbox class="warning__checkbox" [(ngModel)]="showWarning"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_warning_rule" | translate }}
              </mat-checkbox>
              <br>
              <mat-checkbox class="inapplicable__checkbox" [(ngModel)]="showInapplicable"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_not_applicable_rule" | translate }}
              </mat-checkbox>
            </div>

            <div class="filter border" fxFlex.gt-xs="30"
                 [ngClass.lt-sm]="{'right':true, 'left':true, 'bottom-border':true, 'border':false}">
              <h2>
                {{"EVALUATION_PAGE.filters.type" | translate}}
              </h2>
              <mat-checkbox [(ngModel)]="showACT"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_act" | translate }}
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showHTML"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_html" | translate }}
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showCSS"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_css" | translate }}
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showBP"
                            (click)="$event.stopPropagation()">
                {{ "EVALUATION_PAGE.filters.show_bp" | translate }}
              </mat-checkbox>
            </div>
            <div class="filter border" fxFlex.gt-xs="30"
                 [ngClass.lt-sm]="{'right':true, 'left':true, 'bottom-border':true, 'border':false}">
              <h2>
                {{"EVALUATION_PAGE.filters.principle" | translate}}
              </h2>
              <mat-checkbox [(ngModel)]="showPerceivable"
                            (click)="$event.stopPropagation()">{{"PRINCIPLES.perceivable" | translate}}
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showOperable"
                            (click)="$event.stopPropagation()">{{"PRINCIPLES.operable" | translate}}
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showUnderstandable"
                            (click)="$event.stopPropagation()">{{"PRINCIPLES.understandable" | translate}}
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showRobust"
                            (click)="$event.stopPropagation()">{{"PRINCIPLES.robust" | translate}}
              </mat-checkbox>

            </div>

            <div class="filter right" fxFlex [ngClass.lt-sm]="{'left':true}">
              <h2>
                {{"EVALUATION_PAGE.filters.level" | translate}}
              </h2>
              <mat-checkbox [(ngModel)]="showA"
                            (click)="$event.stopPropagation()">A
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showAA"
                            (click)="$event.stopPropagation()">AA
              </mat-checkbox>
              <br>
              <mat-checkbox [(ngModel)]="showAAA"
                            (click)="$event.stopPropagation()">AAA
              </mat-checkbox>
            </div>
          </div>
        </div>
        <!--
          <div fxLayout="row">
            <mat-menu #rulesMenu1="matMenu" yPosition="below" fxLayout="column">
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Language
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Images
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Headers
              </mat-checkbox>
            </mat-menu>
            <mat-menu #rulesMenu2="matMenu" xPosition="after" fxLayout="column">
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">CSS
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Links
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Color
              </mat-checkbox>
            </mat-menu>
            <mat-menu #rulesMenu3="matMenu" xPosition="after" fxLayout="column">
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Title
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Metadata
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Markup
              </mat-checkbox>
            </mat-menu>
          </div> -->
      </div>
    </section>

    <hr class="combo_breaker">

    <section fxLayoutAlign="start center">
      <div fxLayout="column">
        <h1 id="report">
          {{ "EVALUATION_PAGE.report.title" | translate }}
        </h1>

        <div fxLayout.gt-xs="row" fxLayout="column">
          <button class="buttons" mat-stroked-button (click)="expandAllRules()">
            {{ "EVALUATION_PAGE.filters.expand_all" | translate }}
          </button>
          <span fxFlex="0.5"></span>
          <button class="buttons" mat-stroked-button (click)="closeAllRules()">
            {{ "EVALUATION_PAGE.filters.close_all" | translate }}
          </button>
        </div>
        <br>

        <ng-container *ngFor="let rule of rules; trackBy: trackByIndex">
          <mat-expansion-panel *ngIf="showRuleCard(rule)" #panel [ngClass]="getOutcome(rule)"
                               [class.sticky]="panel.expanded">
            <mat-expansion-panel-header [collapsedHeight]="'55px'" [expandedHeight]="'55px'">
              <mat-panel-title fxLayout="row" fxLayoutAlign="start center" fxFlex>
                <div>
                  <mat-icon *ngIf="getOutcome(rule) === 'passed'" class="final-outcome">check_circle_outline
                  </mat-icon>
                  <mat-icon *ngIf="getOutcome(rule) === 'failed'" class="final-outcome">highlight_off</mat-icon>
                  <mat-icon *ngIf="getOutcome(rule) === 'warning'" class="final-outcome">warning</mat-icon>
                  <mat-icon *ngIf="getOutcome(rule) === 'inapplicable'" class="final-outcome">
                    not_interested
                  </mat-icon>
                </div>
                <div class="around_title" fxFlex>
                  <h2 fittext [maxFontSize]="26" [compression]="0.8" class="final-outcome rule_title">
                    <!--{{ "RULES." + rule + ".name" | translate}}-->
                    {{ getValue(rule, 'name')}}
                  </h2>
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <!--div fxShow="panel.expanded" class="filler"></div-->
            <div fxLayout.gt-sm="row" fxLayout="column">
              <!-- TYPE -->
              <div class="rule_type" fxFlex fxFlexOrder.gt-sm="2">
                <h2 class="rule_subtitle">{{"EVALUATION_PAGE.report.type" | translate}}</h2>
                <h3 class="type">{{ getTypeString(rule) }}</h3>
              </div>

              <!-- DESCRIPTION -->
              <div class="order1 rule_description" fxFlex fxFlexOrder.gt-sm="1">
                <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.report.description" | translate}}</h2>
                <!--<p>{{ "RULES." + rule + ".description" | translate }}</p>-->
                <p>{{ getValue(rule, 'description') }}</p>
                <p>
                  <a class="hidden_link" href="{{ getUrl(rule) }}"
                     target="_blank">
                    <code>{{ getUrl(rule) }}</code>
                  </a>
                </p>
                <p *ngIf="getTarget(rule, 'parent') !== ''">
                  {{"EVALUATION_PAGE.report.target_parent" | translate}}
                  <code>{{ getTarget(rule, 'parent') }}</code>
                </p>
                <p *ngIf="getTarget(rule, 'parent-sibling') !== ''">
                  {{"EVALUATION_PAGE.report.target_parent_sibling" | translate}}
                  <code>{{ getTarget(rule, 'parent-sibling') }}</code>
                </p>
                <p *ngIf="getTarget(rule, 'element') !== ''">
                  {{"EVALUATION_PAGE.report.target_elem" | translate}}
                  <code>{{ getTarget(rule, 'element') }}</code>
                </p>
                <p *ngIf="getTarget(rule, 'attributes') !== ''">
                  {{"EVALUATION_PAGE.report.target_attr" | translate}}
                  <code>{{ getTarget(rule, 'attributes') }}</code>
                </p>
                <p *ngIf="getTarget(rule, 'css') !== ''">
                  {{"EVALUATION_PAGE.report.target_css" | translate}}
                  <code>{{ getTarget(rule, 'css') }}</code>
                </p>
                <p *ngIf="getTarget(rule, 'children') !== ''">
                  {{"EVALUATION_PAGE.report.target_children" | translate}}
                  <code>{{ getTarget(rule, 'children') }}</code>
                </p>
              </div>
            </div>

            <div *ngIf="getSuccessCriteria(rule)" fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="2">
              <!-- SUCCESS CRITERIA -->
              <div class="rule_criteria" fxFlex fxFlexOrder.gt-sm="2">
                <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.report.criteria.title" | translate}}</h2>
                <li *ngFor="let sc of getSuccessCriteria(rule); trackBy: trackByIndex">
                  {{ sc.name }} - {{ "SUCCESS_CRITERIA." + sc.name | translate}}
                  ({{"EVALUATION_PAGE.report.criteria.level" | translate}} {{ sc.level }})
                </li>
              </div>

              <!-- FILTERS -->
              <div *ngIf="!areAllTheSameTypeOfResults(rule)" class="rule_filters" fxFlex fxFlexOrder.gt-sm="1">
                <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.filters.title" | translate}}</h2>
                <div fxLayout="column">
                  <mat-checkbox class="passed__checkbox"
                                [(ngModel)]="showRulesResults[rule].passed">
                    {{ "EVALUATION_PAGE.filters.show_passed_result" | translate }}
                    -
                    <b>{{ getNumberResults(rule)[0] }}</b>
                    <span
                      *ngIf="getNumberResults(rule)[0] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[0] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </mat-checkbox>
                  <mat-checkbox class="failed__checkbox"
                                [(ngModel)]="showRulesResults[rule].failed">
                    {{ "EVALUATION_PAGE.filters.show_failed_result" | translate }}
                    -
                    <b>{{ getNumberResults(rule)[1] }}</b>
                    <span
                      *ngIf="getNumberResults(rule)[1] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[1] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </mat-checkbox>
                  <mat-checkbox class="warning__checkbox"
                                [(ngModel)]="showRulesResults[rule].warning">
                    {{ "EVALUATION_PAGE.filters.show_warning_result" | translate }}
                    -
                    <b>{{ getNumberResults(rule)[2] }}</b>
                    <span
                      *ngIf="getNumberResults(rule)[2] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[2] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </mat-checkbox>
                  <mat-checkbox class="inapplicable__checkbox" [(ngModel)]="showRulesResults[rule].inapplicable">
                    {{ "EVALUATION_PAGE.filters.show_not_applicable_result" | translate }}
                    -
                    <b>{{ getNumberResults(rule)[3] }}</b>
                    <span
                      *ngIf="getNumberResults(rule)[3] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[3] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </mat-checkbox>
                </div>
              </div>
            </div>

            <!-- ACCESSIBILITY REPORT -->
            <div class="rule_results">
              <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.report.results" | translate}}</h2>

              <!-- when there are no results -->
              <ng-container *ngIf="noResults(rule)">
                <mat-card class="inapplicable" fxLayout="column">
                  <mat-card-header>
                    <mat-card-title>
                      {{ "EVALUATION_PAGE.report.no_results" | translate }}
                    </mat-card-title>
                  </mat-card-header>
                </mat-card>
              </ng-container>

              <ng-container *ngFor="let results of orderRuleResult(rule); trackBy: trackByIndex">

                <ng-container *ngIf="results.length > 0">
                  <h3 *ngIf="results[0]['verdict'] === 'passed' && showRulesResults[rule]['passed']">
                    <span class="passed">{{ "EVALUATION_PAGE.filters.show_passed_result" | translate }}</span>
                    - {{ getNumberResults(rule)[0] }}
                    <span
                      *ngIf="getNumberResults(rule)[0] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[0] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </h3>

                  <h3 *ngIf="results[0]['verdict'] === 'failed' && showRulesResults[rule]['failed']">
                    <span class="failed">{{ "EVALUATION_PAGE.filters.show_failed_result" | translate }}</span>
                    - {{ getNumberResults(rule)[1] }}
                    <span
                      *ngIf="getNumberResults(rule)[1] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[1] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </h3>

                  <h3 *ngIf="results[0]['verdict'] === 'warning' && showRulesResults[rule]['warning']">
                    <span class="warning">{{ "EVALUATION_PAGE.filters.show_warning_result" | translate }}</span>
                    - {{ getNumberResults(rule)[2] }}
                    <span
                      *ngIf="getNumberResults(rule)[2] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[2] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </h3>

                  <h3 *ngIf="results[0]['verdict'] === 'inapplicable' && showRulesResults[rule]['inapplicable']">
                    <span
                      class="inapplicable">{{ "EVALUATION_PAGE.filters.show_not_applicable_result" | translate }}</span>
                    - {{ getNumberResults(rule)[3] }}
                    <span
                      *ngIf="getNumberResults(rule)[3] === 1"> {{"EVALUATION_PAGE.filters.result" | translate}}</span>
                    <span
                      *ngIf="getNumberResults(rule)[3] !== 1"> {{"EVALUATION_PAGE.filters.results" | translate}}</span>
                  </h3>
                </ng-container>

                <ng-container *ngFor="let test of results; trackBy: trackByIndex">
                  <mat-card *ngIf="showRulesResults[rule][test.verdict]" [ngClass]="test.verdict" fxLayout="column">

                    <mat-card-header>
                      <mat-card-title [class.with-code]="test.htmlCode || test.cssCode">
                        <!--{{ "RULES." + rule + "." + test.resultCode | translate}}-->
                        {{ test.description }}
                      </mat-card-title>
                    </mat-card-header>

                    <mat-card-content fxLayoutAlign="start center" *ngIf="test.htmlCode || test.cssCode"
                                      fxLayout="row" fxLayoutGap="2" fxFlex>

                      <pre *ngIf="getType(rule) === 'act' || getType(rule) === 'html' || getType(rule) === 'bp'" fxFlex="95"><code>{{ formatCode(test.htmlCode) }}</code></pre> <!-- [highlight]="" -->
                      <pre *ngIf="getType(rule) === 'css'" fxFlex="100"><code>{{ test.cssCode.toString() }}</code></pre> <!-- [highlight]="" -->

                      <button *ngIf="!getType(rule) === 'css'" mat-icon-button fxFlex (click)="openCodeDialog(test.htmlCode)"
                              matTooltip="{{'EVALUATION_PAGE.report.result_code' | translate}}">
                        <mat-icon class="eyeicon">visibility</mat-icon>
                      </button>

                    </mat-card-content>

                    <!--<mat-card-content fxLayout="row" fxLayoutAlign="start center" *ngIf="!test.code">
                      <div fxLayout="column" fxFlex>
                        Não existe código
                      </div>
                    </mat-card-content>-->
                  </mat-card>
                  <br *ngIf="showRulesResults[rule][test.verdict]">
                </ng-container>
              </ng-container>
            </div>

          </mat-expansion-panel>

          <br *ngIf="showRuleCard(rule)">

        </ng-container>
      </div>
    </section>
  </div>
  <span fxFlex></span>
</div>
<div *ngIf="evaluateLoading" fxLayout="column">
  <div fxLayoutAlign="center center">
    <img src="/assets/images/logo2.png" alt="Qualweb logo"/>
  </div>
  <div fxLayoutAlign="center center">
    <mat-spinner color="primary" [diameter]="130" [strokeWidth]="13"></mat-spinner>
  </div>
</div>

