<span *ngIf="error">
  <app-error-page></app-error-page>
</span>

<div id="evaluation-content" *ngIf="!evaluateLoading && !error" fxLayout="row">
  <span fxFlex=10></span>

  <div fxFlex="80">
    <hr class="combo_breaker">
    <section fxLayoutAlign="start center">
      <div fxFlex>
        <h1 id="summary">
          {{ "EVALUATION_PAGE.summary.title" | translate }}
        </h1>

        <table class="summary_table">
          <tr>
            <th colspan="3" fittext [maxFontSize]="22" class="url"><a class="hidden_link"
                                                                      href="{{ json.system.url.inputUrl }}"
                                                                      target="_blank">{{ json.system.url.inputUrl }}</a>
            </th>
          </tr>
          <tr>
            <td colspan="3" fittext [maxFontSize]="25">
              {{json.metadata.passed + json.metadata.failed + json.metadata.inapplicable + json.metadata.warning}} {{"EVALUATION_PAGE.summary.rules" | translate}}
            </td>
          </tr>
          <tr class="summary_icons">
            <span fxFlex="32"></span>
            <td fittext [maxFontSize]="30">
              <span class="screenreader">{{"EVALUATION_PAGE.summary.passed" | translate}}</span>
              <mat-icon class="passed">check_circle_outline</mat-icon>
              {{ json.metadata.passed }}
            </td>
            <td fittext [maxFontSize]="30">
              <span class="screenreader">{{"EVALUATION_PAGE.summary.failed" | translate}}</span>
              <mat-icon class="failed">highlight_off</mat-icon>
              {{ json.metadata.failed }}
            </td>
            <td fittext [maxFontSize]="30">
              <span class="screenreader">{{"EVALUATION_PAGE.summary.warning" | translate}}</span>
              <mat-icon class="warning">warning</mat-icon>
              {{ json.metadata.warning }}
            </td>
            <td fittext [maxFontSize]="30">
              <span class="screenreader">{{"EVALUATION_PAGE.summary.inapplicable" | translate}}</span>
              <mat-icon class="inapplicable">not_interested</mat-icon>
              {{ json.metadata.inapplicable }}
            </td>
            <span fxFlex="32%"></span>
          </tr>
        </table>
      </div>
    </section>

    <hr class="combo_breaker">

    <section class="filters">
      <div fxLayout="column">
        <h1 id="filters">
          {{ "EVALUATION_PAGE.filters.title" | translate }}
        </h1>

        <div fxLayout="row">

          <div class="filter left border" fxFlex fxFlex.gt-sm="20">
            <h2>
              {{"EVALUATION_PAGE.filters.outcome" | translate}}
            </h2>
            <mat-checkbox class="dropdown-item passed__checkbox" [(ngModel)]="showPassed"
                          (click)="$event.stopPropagation()">
              {{ "EVALUATION_PAGE.filters.show_passed_rule" | translate }}
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item failed__checkbox" [(ngModel)]="showFailed"
                          (click)="$event.stopPropagation()">
              {{ "EVALUATION_PAGE.filters.show_failed_rule" | translate }}
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item warning__checkbox" [(ngModel)]="showWarning"
                          (click)="$event.stopPropagation()">
              {{ "EVALUATION_PAGE.filters.show_warning_rule" | translate }}
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item inapplicable__checkbox" [(ngModel)]="showInapplicable"
                          (click)="$event.stopPropagation()">
              {{ "EVALUATION_PAGE.filters.show_not_applicable_rule" | translate }}
            </mat-checkbox>
          </div>

          <div class="filter border" fxFlex fxFlex.gt-sm="20">
            <h2>
              {{"EVALUATION_PAGE.filters.principle" | translate}}
            </h2>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showPerceivable"
                          (click)="$event.stopPropagation()">{{"PRINCIPLES.perceivable" | translate}}
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showOperable"
                          (click)="$event.stopPropagation()">{{"PRINCIPLES.operable" | translate}}
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showUnderstandable"
                          (click)="$event.stopPropagation()">{{"PRINCIPLES.understandable" | translate}}
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showRobust"
                          (click)="$event.stopPropagation()">{{"PRINCIPLES.robust" | translate}}
            </mat-checkbox>

          </div>

          <div class="filter right" fxFlex fxFlex.gt-sm="20">
            <h2>
              {{"EVALUATION_PAGE.filters.level" | translate}}
            </h2>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showA"
                          (click)="$event.stopPropagation()">A
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showAA"
                          (click)="$event.stopPropagation()">AA
            </mat-checkbox>
            <br>
            <mat-checkbox class="dropdown-item" [(ngModel)]="showAAA"
                          (click)="$event.stopPropagation()">AAA
            </mat-checkbox>

          </div>
        </div>
        <!--
          <div fxLayout="row">
            <mat-menu #rulesMenu1="matMenu" yPosition="below" fxLayout="column">
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Language
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Images
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Headers
              </mat-checkbox>
            </mat-menu>
            <mat-menu #rulesMenu2="matMenu" xPosition="after" fxLayout="column">
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">CSS
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Links
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Color
              </mat-checkbox>
            </mat-menu>
            <mat-menu #rulesMenu3="matMenu" xPosition="after" fxLayout="column">
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Title
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Metadata
              </mat-checkbox>
              <mat-checkbox class="mat-menu-item" color="primary"
                            (click)="$event.stopPropagation()">Markup
              </mat-checkbox>
            </mat-menu>
          </div> -->
      </div>
    </section>

    <hr class="combo_breaker">

    <section fxLayout="row" fxLayoutAlign="start center">
      <div fxFlex>
        <h1 id="report">
          {{ "EVALUATION_PAGE.report.title" | translate }}
        </h1>

        <div fxLayout.gt-xs="row" fxLayout="column">
          <button class="buttons" mat-stroked-button (click)="expandAllRules()">
            {{ "EVALUATION_PAGE.filters.expand_all" | translate }}
          </button>
          <span fxFlex="0.5"></span>
          <button class="buttons" mat-stroked-button (click)="closeAllRules()">
            {{ "EVALUATION_PAGE.filters.close_all" | translate }}
          </button>
        </div>
        <br>

        <ng-container *ngFor="let rule of rules">
          <mat-expansion-panel *ngIf="showRuleCard(rule)" [ngClass]="getOutcome(rule)">
            <mat-expansion-panel-header [collapsedHeight]="'55px'" [expandedHeight]="'55px'">
              <mat-panel-title fxLayout="row" fxLayoutAlign="start center">
                <mat-icon *ngIf="getOutcome(rule) === 'passed'" class="final-outcome">check_circle_outline
                </mat-icon>
                <mat-icon *ngIf="getOutcome(rule) === 'failed'" class="final-outcome">highlight_off</mat-icon>
                <mat-icon *ngIf="getOutcome(rule) === 'inapplicable'" class="final-outcome">
                  not_interested
                </mat-icon>
                <h2 fittext [maxFontSize]="25" class="final-outcome rule_title">
                  {{ "RULES." + rule + ".name" | translate}}
                </h2>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div fxLayout.gt-sm="row" fxLayout="column" fxLayoutGap="2">

              <!-- DESCRIPTION -->
              <div fxFlex.gt-sm="49" fxFlex class="rule_description">
                <h2 class="rule_subtitle">{{"EVALUATION_PAGE.report.description" | translate}}</h2>
                <p>{{ "RULES." + rule + ".description" | translate }}</p>
                <p>
                  <a class="hidden_link" href="{{ json.modules['act-rules'].rules[rule].metadata.url }}"
                     target="_blank">
                    <code>{{ json.modules['act-rules'].rules[rule].metadata.url }}</code>
                  </a>
                </p>
                <p *ngIf="json.modules['act-rules'].rules[rule].metadata.target.element">
                  {{"EVALUATION_PAGE.report.target_elem" | translate}}
                  <code>{{ json.modules['act-rules'].rules[rule].metadata.target.element }}</code>
                </p>
                <p *ngIf="json.modules['act-rules'].rules[rule].metadata.target.attributes">
                  {{"EVALUATION_PAGE.report.target_attr" | translate}}
                  <code>{{ json.modules['act-rules'].rules[rule].metadata.target.attributes }}</code>
                </p>
              </div>

              <!-- SUCCESS CRITERIA -->
              <div fxFlex.gt-sm="49" fxFlex class="rule_criteria">
                <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.report.criteria.title" | translate}}</h2>
                <li *ngFor="let sc of json.modules['act-rules'].rules[rule].metadata['success-criteria']">
                  {{ sc.name }} - {{ "SUCCESS_CRITERIA." + sc.name | translate}}
                  ({{"EVALUATION_PAGE.report.criteria.level" | translate}} {{ sc.level }})
                </li>
              </div>
            </div>

            <div class="reset_font_size">
              <!-- FILTERS -->
              <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.filters.title" | translate}}</h2>
              <div fxLayout="column">
                <mat-checkbox class="passed__checkbox"
                              [(ngModel)]="showRulesResults[rule].passed">
                  {{ "EVALUATION_PAGE.filters.show_passed_result" | translate }}
                  -
                  <b>{{ json.modules['act-rules'].rules[rule].metadata.passed }}</b> {{"EVALUATION_PAGE.filters.results" | translate}}
                </mat-checkbox>
                <mat-checkbox class="failed__checkbox"
                              [(ngModel)]="showRulesResults[rule].failed">
                  {{ "EVALUATION_PAGE.filters.show_failed_result" | translate }}
                  -
                  <b>{{ json.modules['act-rules'].rules[rule].metadata.failed }}</b> {{"EVALUATION_PAGE.filters.results" | translate}}
                </mat-checkbox>
                <mat-checkbox class="warning__checkbox"
                              [(ngModel)]="showRulesResults[rule].warning">
                  {{ "EVALUATION_PAGE.filters.show_warning_result" | translate }}
                  -
                  <b>{{ json.modules['act-rules'].rules[rule].metadata.warning }}</b> {{"EVALUATION_PAGE.filters.results" | translate}}
                </mat-checkbox>
                <mat-checkbox class="inapplicable__checkbox" [(ngModel)]="showRulesResults[rule].inapplicable">
                  {{ "EVALUATION_PAGE.filters.show_not_applicable_result" | translate }}
                  -
                  <b>{{ json.modules['act-rules'].rules[rule].metadata.inapplicable }}</b> {{"EVALUATION_PAGE.filters.results" | translate}}
                </mat-checkbox>
              </div>

              <!-- ACCESSIBILITY REPORT -->
              <h2 class="rule_subtitle mobile">{{"EVALUATION_PAGE.report.results" | translate}}</h2>

              <ng-container *ngFor="let test of orderRuleResult(rule)">
                <mat-card *ngIf="showRulesResults[rule][test.verdict]" [ngClass]="test.verdict">

                  <mat-card-header>
                    <mat-card-title>
                      {{ "RULES." + this.json.modules['act-rules'].rules[rule].code + "." + test.resultCode | translate}}
                    </mat-card-title>
                  </mat-card-header>

                  <mat-card-content fxLayout="row" fxLayoutAlign="start center">
                    <div fxLayout="column" fxFlex="95">
                      <ngx-highlight [code]="formatCode(test.code)" lang="html"></ngx-highlight>
                    </div>
                    <span fxFlex="2"></span>
                    <button mat-icon-button (click)="openCodeDialog(test.code)"
                            matTooltip="{{'EVALUATION_PAGE.report.result_code' | translate}}">
                      <mat-icon class="eyeicon">visibility</mat-icon>
                    </button>
                  </mat-card-content>

                </mat-card>
                <br *ngIf="showRulesResults[rule][test.verdict]">
              </ng-container>
            </div>

          </mat-expansion-panel>

          <br *ngIf="showRuleCard(rule)">

        </ng-container>
      </div>
    </section>
  </div>
</div>
<div *ngIf="evaluateLoading" fxLayout="column">
  <div fxLayoutAlign="center center">
    <img src="/assets/images/logo2.png" alt="Qualweb logo"/>
  </div>
  <div fxLayoutAlign="center center">
    <mat-spinner color="primary" [diameter]="130" [strokeWidth]="13"></mat-spinner>
  </div>
</div>

